

[![codecov](https://codecov.io/gh/lanasergeeva/job4j_pooh/branch/master/graph/badge.svg?token=FUS7W3NDK7)](https://codecov.io/gh/lanasergeeva/job4j_pooh)

[![Build Status](https://app.travis-ci.com/lanasergeeva/job4j_pooh.svg?branch=master)](https://app.travis-ci.com/lanasergeeva/job4j_pooh)

# Проект "Pooh JMS"

## Описание

В этом проекте создается аналог асинхронной очереди.
Приложение запускает Socket и ждет клиентов.
Клиенты могут быть двух типов: отправители (publisher), получатели (subscriber).
В качестве клиента используется cURL. https://curl.se/download.html
В качестве протокола используется HTTP. 

## Пример работы программы
![alt text](https://github.com/lanasergeeva/job4j_pooh/blob/master/src/main/java/ru/java/pooh/img/example.jpg).

## Описание классов
#### 1. Класс Req
   Этот класс представляет HTTP-запрос. Он содержит следующие поля:
method — метод HTTP-запроса (GET, POST и т.д.).
mode — режим (например, topic или queue).
name — имя ресурса (например, weather).
text — текст запроса (данные для передачи в POST-запросах).
id — идентификатор запроса, который используется для топиков.
Статический метод of разбирает строку HTTP-запроса и формирует объект Req, используя регулярные выражения.

#### 2. Класс Resp
   Этот класс представляет HTTP-ответ. Он содержит два поля:
text — текст ответа (например, сообщение или данные).
status — HTTP-статус (например, 200 для успешного запроса).

#### 3. Интерфейс Service
   Интерфейс, который должен реализовать любой сервис для обработки запросов. Метод process(Req req) принимает объект запроса и возвращает объект ответа Resp.

#### 4. Класс TopicService
Этот класс реализует логику для режима "topic", где каждый подписчик может получать сообщения, относящиеся к определенной теме (topic).
Данные хранятся в двух структурах:
queue — очередь сообщений для каждого топика.
map — карта, где каждому подписчику (идентифицируемому по id) назначается отдельная очередь сообщений.
Методы:
При POST запросе новое сообщение добавляется в общую очередь для топика, а также для каждого подписчика создается копия этой очереди.
При GET запросе подписчик получает первое сообщение из своей очереди.

#### 5. Класс PoohServer
   Это основной класс сервера. Он выполняет следующие задачи:
Создает серверный сокет, который слушает порт 9000.
Принимает соединения и создает новый поток для каждого запроса.
Разбирает HTTP-запрос с помощью класса Req и вызывает соответствующий сервис (queue или topic).
Отправляет HTTP-ответ с помощью класса Resp.
Сервер использует пул потоков для обработки входящих запросов параллельно, что позволяет ему обрабатывать несколько клиентов одновременно.

#### 6. Алгоритм работы сервера
   Клиент отправляет HTTP-запрос.
   Сервер принимает запрос, разбирает его с помощью класса Req.
   В зависимости от режима (queue или topic), запрос обрабатывается соответствующим сервисом.
   Сформированный ответ отправляется клиенту.

#### Итог:
Это приложение представляет собой простой HTTP-сервер с поддержкой двух режимов работы:
Очередь (queue): Сообщения помещаются в общую очередь и каждый клиент забирает сообщение по мере поступления.
Топик (topic): Сообщения распределяются между подписчиками, каждый подписчик получает свои сообщения, даже если он подключился позже.